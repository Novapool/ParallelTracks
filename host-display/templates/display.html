<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParallelTracks - Host Display</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header with trolley image -->
        <header class="trolley-header">
            <img src="{{ url_for('static', filename='images/trolley-problem.png') }}"
                 alt="Trolley Problem"
                 class="trolley-image"
                 id="scenario-image">
        </header>

        <!-- AI Model Logos -->
        <div class="model-logos">
            {% for model in models %}
            <div class="model-logo">
                <img src="{{ url_for('static', filename='images/logos/' + model + '.png') }}"
                     alt="{{ model }}"
                     class="logo-img">
            </div>
            {% endfor %}
        </div>

        <!-- Audio Auto-play Unlock Panel -->
        <div id="audio-unlock-panel" class="audio-unlock-panel" style="display: none;">
            <button id="audio-unlock-btn" class="pixel-btn audio-unlock-btn">
                ðŸ”Š Enable Audio Auto-play
            </button>
            <p class="unlock-message">Click to enable automatic audio playback</p>
        </div>

        <!-- Question Display -->
        <div class="question-display">
            <h2 class="pixel-text">Current Question</h2>
            <p id="question-text" class="question-text">No active question</p>
        </div>

        <!-- AI Responses Grid -->
        <div class="responses-grid">
            {% for model in models %}
            <div class="response-card" data-model="{{ model }}" style="border-color: {{ colors[model] }};">
                <div class="response-header" style="background-color: {{ colors[model] }};">
                    <h3 class="pixel-text">{{ model|upper }}</h3>
                </div>
                <div class="response-body">
                    <p class="response-text" id="response-{{ model }}">Waiting for response...</p>
                    <div class="audio-controls">
                        <audio id="audio-{{ model }}" controls style="display: none;">
                            <source id="audio-src-{{ model }}" src="" type="audio/mpeg">
                        </audio>
                        <button class="play-btn pixel-btn" id="play-{{ model }}" style="display: none;">
                            â–¶ Play
                        </button>
                    </div>
                </div>
                <!-- Colored subtitle overlay during playback -->
                <div class="subtitle-overlay" id="subtitle-{{ model }}"
                     style="background-color: {{ colors[model] }}; display: none;">
                    <p class="subtitle-text"></p>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Admin Controls -->
        <div class="admin-panel">
            <h3 class="pixel-text">Admin: Submit New Question</h3>

            <!-- Template Display -->
            <div class="template-display">
                <p class="template-text">
                    You must choose between two bad outcomes: allowing a runaway trolley to
                    <span class="blank-placeholder">[BLANK 1]</span>
                    or pulling a lever to divert it to a side track where it will
                    <span class="blank-placeholder">[BLANK 2]</span>.
                </p>
            </div>

            <form id="question-form">
                <!-- Outcome 1 -->
                <div class="form-field">
                    <label class="field-label" for="outcome1">OUTCOME 1: DO NOTHING</label>
                    <textarea id="outcome1"
                              placeholder="kill 5 innocent workers on the main track"
                              rows="2"
                              minlength="3"
                              maxlength="500"
                              required></textarea>
                    <div class="char-counter">
                        <span id="counter1">0</span> / 500
                    </div>
                </div>

                <!-- Outcome 2 -->
                <div class="form-field">
                    <label class="field-label" for="outcome2">OUTCOME 2: PULL LEVER</label>
                    <textarea id="outcome2"
                              placeholder="kill 1 innocent person on the side track"
                              rows="2"
                              minlength="3"
                              maxlength="500"
                              required></textarea>
                    <div class="char-counter">
                        <span id="counter2">0</span> / 500
                    </div>
                </div>

                <!-- Live Preview -->
                <div class="question-preview">
                    <h4 class="pixel-text preview-title">Preview</h4>
                    <p id="preview-text" class="preview-content">
                        You must choose between two bad outcomes: allowing a runaway trolley to
                        <span class="preview-blank">[...]</span>
                        or pulling a lever to divert it to a side track where it will
                        <span class="preview-blank">[...]</span>.
                    </p>
                </div>

                <button type="submit" class="pixel-btn submit-btn">Submit Question</button>
            </form>
            <div id="status-message" class="status-message"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/display.js') }}"></script>
</body>
</html>
